<!-- DeviceManagerWindow.xaml - 加入設備搜尋功能 -->
<Window x:Class="SentryX.DeviceManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設備管理 - Device Manager" 
        Height="700" Width="1000"
        MinHeight="1024" MinWidth="1024"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 工具列 -->
            <RowDefinition Height="*"/>
            <!-- 設備清單 -->
            <RowDefinition Height="*"/>
            <!-- 設備搜尋區 -->
            <RowDefinition Height="Auto"/>
            <!-- 設備詳情 -->
            <RowDefinition Height="200"/>
            <!-- 狀態區 -->
        </Grid.RowDefinitions>

        <!-- ✅ 簡化後的工具列 -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="LightGray" Margin="5">
            <Button Name="AddDeviceButton" Content="➕ 添加設備" Click="AddDeviceButton_Click"
                    ToolTip="清空輸入欄位，準備添加新設備"/>
            <Button Name="EditDeviceButton" Content="✏️ 編輯設備" Click="EditDeviceButton_Click"
                    ToolTip="編輯選中的設備資訊"/>
            <Button Name="RemoveDeviceButton" Content="🗑️ 移除設備" Click="RemoveDeviceButton_Click"
                    ToolTip="移除選中的設備"/>
            <Separator Width="20"/>
            <Button Name="LogoutDeviceButton" Content="📤 登出設備" Click="LogoutDeviceButton_Click"
                    ToolTip="登出選中的設備"/>

            <!-- 顯示自動刷新狀態 -->
            <Separator Width="20"/>
            <TextBlock Text="🔄 自動刷新" VerticalAlignment="Center" 
                       Foreground="Green" FontWeight="Bold"/>
        </StackPanel>

        <!-- 設備清單 -->
        <DataGrid Grid.Row="1" Name="DeviceDataGrid" 
                  AutoGenerateColumns="False"
                  SelectionMode="Single"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  Margin="5"
                  SelectionChanged="DeviceDataGrid_SelectionChanged">
            <DataGrid.Columns>
                <DataGridTextColumn Header="設備名稱" Binding="{Binding Name}" Width="150" IsReadOnly="True"/>
                <DataGridTextColumn Header="IP 地址" Binding="{Binding IpAddress}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="埠號" Binding="{Binding Port}" Width="60" IsReadOnly="True"/>
                <DataGridTextColumn Header="帳號" Binding="{Binding Username}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="序號" Binding="{Binding SerialNumber}" Width="150" IsReadOnly="True"/>
                <DataGridTextColumn Header="通道數" Binding="{Binding ChannelCount}" Width="60" IsReadOnly="True"/>
                <DataGridTextColumn Header="狀態" Binding="{Binding StatusDisplay}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="最後連接" Binding="{Binding LastConnectTime, StringFormat='{}{0:MM-dd HH:mm}'}" Width="100" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ✅ 新增：設備搜尋區 -->
        <GroupBox Grid.Row="2" Header="網路設備搜尋" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 搜尋控制 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                    <Button Name="SearchDevicesButton" Content="🔍 搜尋設備" 
                            Click="SearchDevicesButton_Click" Padding="10,5"
                            Background="LightBlue" FontWeight="Bold"
                            ToolTip="搜尋網路中的大華設備"/>
                    <Button Name="StopSearchButton" Content="⏹️ 停止搜尋" 
                            Click="StopSearchButton_Click" Margin="10,0,0,0"
                            IsEnabled="False" ToolTip="停止設備搜尋"/>
                    <TextBlock Name="SearchStatusText" Text="準備搜尋..." 
                               VerticalAlignment="Center" Margin="20,0,0,0"
                               Foreground="Blue" FontWeight="Bold"/>
                </StackPanel>

                <!-- 搜尋結果清單 -->
                <DataGrid Grid.Row="1" Name="SearchResultDataGrid" 
                          AutoGenerateColumns="False"
                          SelectionMode="Single"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Margin="5"
                          SelectionChanged="SearchResultDataGrid_SelectionChanged"
                          MouseDoubleClick="SearchResultDataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="序號" Binding="{Binding Index}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="初始化狀態" Binding="{Binding InitStatusDisplay}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="IP 版本" Binding="{Binding IPVersion}" Width="70" IsReadOnly="True"/>
                        <DataGridTextColumn Header="IP 地址" Binding="{Binding IP}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="埠號" Binding="{Binding Port}" Width="60" IsReadOnly="True"/>
                        <DataGridTextColumn Header="子網掩碼" Binding="{Binding SubMask}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="網關" Binding="{Binding Gateway}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="MAC 地址" Binding="{Binding MAC}" Width="140" IsReadOnly="True"/>
                        <DataGridTextColumn Header="設備類型" Binding="{Binding DeviceType}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="詳細類型" Binding="{Binding DetailType}" Width="150" IsReadOnly="True"/>
                        <DataGridTextColumn Header="HTTP 埠" Binding="{Binding HttpPort}" Width="80" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- 設備詳情編輯區 -->
        <GroupBox Grid.Row="3" Header="設備詳情" Margin="5">
            <StackPanel Orientation="Vertical">
                <!-- 第一行 -->
                <StackPanel Orientation="Horizontal" Margin="5">
                    <TextBlock Text="設備名稱:" Width="80" VerticalAlignment="Center"/>
                    <TextBox Name="DeviceNameTextBox" Width="150" Margin="5,0"/>

                    <TextBlock Text="IP 地址:" Width="60" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <TextBox Name="DeviceIPTextBox" Width="120" Margin="5,0"/>

                    <TextBlock Text="埠號:" Width="40" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <TextBox Name="DevicePortTextBox" Text="37777" Width="60" Margin="5,0"/>
                </StackPanel>

                <!-- 第二行 -->
                <StackPanel Orientation="Horizontal" Margin="5">
                    <TextBlock Text="帳號:" Width="80" VerticalAlignment="Center"/>
                    <TextBox Name="UsernameTextBox" Text="admin" Width="150" Margin="5,0"/>

                    <TextBlock Text="密碼:" Width="60" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    <PasswordBox Name="PasswordBox" Password="123456" Width="120" Margin="5,0"/>

                    <!-- ✅ 改成儲存並連接 -->
                    <Button Name="SaveDeviceButton" Content="💾 儲存並連接" 
                            Click="SaveDeviceButton_Click" Margin="30,0,0,0" Padding="15,5"
                            Background="LightGreen" FontWeight="Bold"
                            ToolTip="儲存設備資訊並立即嘗試連接"/>
                    
                    <!-- ✅ 新增：從搜尋結果填入 -->
                    <Button Name="FillFromSearchButton" Content="📋 從搜尋填入" 
                            Click="FillFromSearchButton_Click" Margin="10,0,0,0" Padding="10,5"
                            Background="LightYellow" IsEnabled="False"
                            ToolTip="將選中的搜尋結果填入詳情欄位"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- 狀態區 -->
        <GroupBox Grid.Row="4" Header="操作狀態" Margin="5">
            <ScrollViewer>
                <TextBlock Name="StatusTextBlock" 
                          Text="設備管理器已就緒，具備自動刷新功能..."
                          TextWrapping="Wrap"
                          Margin="5"/>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</Window>